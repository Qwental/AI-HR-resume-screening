events {}

http {
  # –≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É –≤–∞—Å —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –æ—Å—Ç–∞–≤–ª—è–µ–º –∏—Ö
  proxy_http_version 1.1;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection $connection_upgrade;

  map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
  }

  # Upstream-—Å–µ—Ä–≤–µ—Ä—ã —Ç–æ–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤–µ—Ä–Ω–æ
  upstream frontend { server frontend:3000; }
  upstream auth { server auth:8080; }
  upstream interview { server interview:8081; }

  server {
    listen 80;
    # –£–≤–µ–ª–∏—á–∏–º –ª–∏–º–∏—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
    client_max_body_size 20M;

    # 1. –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (/api/auth/...)
    # –≠—Ç–æ—Ç –±–ª–æ–∫ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π, –ø–æ—ç—Ç–æ–º—É –æ–Ω –∏–¥–µ—Ç –ø–µ—Ä–≤—ã–º.
    location /api/auth/ {
      proxy_pass http://auth/api/auth/;
    }

    # 2. üî• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API (/api/...)
    # –≠—Ç–æ—Ç –±–ª–æ–∫ –ª–æ–≤–∏—Ç –≤—Å–µ, —á—Ç–æ –Ω–µ –ø–æ–¥–æ—à–ª–æ –≤—ã—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, /api/vacancies).
    # –ó–∞–ø—Ä–æ—Å –∫ /api/vacancies –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ http://interview:8081/api/vacancies
    location /api/ {
      proxy_pass http://interview/api/;
    }

    # 3. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ - –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
    location / {
      proxy_pass http://frontend;
    }
  }
}
